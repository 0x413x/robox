{
  "variables": {
    "box_version": "{{env `VERSION`}}"
  },
  "provisioners": [
    {
        "type": "shell",
        "scripts": [
            "scripts/centos6/fixdns.sh",
            "scripts/centos6/base.sh",
            "scripts/centos6/reboot.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/centos6/kernel.sh",
            "scripts/centos6/virtualbox.sh",
            "scripts/centos6/vmware.sh",
            "scripts/centos6/qemu.sh",
            "scripts/centos6/vagrant.sh",
            "scripts/centos6/magma.sh",
            "scripts/centos6/tuning.sh",
            "scripts/centos6/sshd.sh",
            "scripts/centos6/cleanup.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "pause_before": "120s",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/centos6/fixdns.sh",
            "scripts/centos6/base.sh",
            "scripts/centos6/reboot.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-centos6-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/centos6/kernel.sh",
            "scripts/centos6/virtualbox.sh",
            "scripts/centos6/vmware.sh",
            "scripts/centos6/qemu.sh",
            "scripts/centos6/vagrant.sh",
            "scripts/centos6/magma.sh",
            "scripts/centos6/tuning.sh",
            "scripts/centos6/sshd.sh",
            "scripts/centos6/cleanup.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "pause_before": "120s",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-centos6-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/centos7/fixdns.sh",
            "scripts/centos7/yum.sh",
            "scripts/centos7/base.sh",
            "scripts/centos7/reboot.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-centos7-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/centos7/kernel.sh",
            "scripts/centos7/virtualbox.sh",
            "scripts/centos7/vmware.sh",
            "scripts/centos7/qemu.sh",
            "scripts/centos7/vagrant.sh",
            "scripts/centos7/magma.sh",
            "scripts/centos7/tuning.sh",
            "scripts/centos7/sshd.sh",
            "scripts/centos7/cleanup.sh",
            "scripts/centos7/unyum.sh"
        ],
        "execute_command": "echo 'vagrant' | sudo -S bash '{{.Path}}'",
        "pause_before": "120s",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-centos7-virtualbox"]
    },
    {
      "scripts": [
        "scripts/gentoo/install.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-gentoo-virtualbox"]
    },
    {
      "scripts": [
        "scripts/gentoo/magma.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-gentoo-virtualbox"]
    },
    {
      "scripts": [
        "scripts/arch/magma.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-arch-virtualbox"]
    },
    {
      "scripts": [
        "scripts/debian8/apt.sh",
        "scripts/debian8/virtualbox.sh",
        "scripts/debian8/vmware.sh",
        "scripts/debian8/qemu.sh",
        "scripts/debian8/network.sh",
        "scripts/debian8/postfix.sh",
        "scripts/debian8/database.sh",
        "scripts/debian8/limits.sh",
        "scripts/debian8/memcached.sh",
        "scripts/debian8/vagrant.sh",
        "scripts/debian8/fixtty.sh",
        "scripts/debian8/magma.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-debian8-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/fedora25/fixdns.sh",
            "scripts/fedora25/dnf.sh",
            "scripts/fedora25/base.sh",
            "scripts/fedora25/reboot.sh"
        ],
        "type": "shell",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-fedora25-virtualbox"]
    },
    {
        "type": "shell",
        "scripts": [
            "scripts/fedora25/kernel.sh",
            "scripts/fedora25/virtualbox.sh",
            "scripts/fedora25/vmware.sh",
            "scripts/fedora25/qemu.sh",
            "scripts/fedora25/vagrant.sh",
            "scripts/fedora25/magma.sh",
            "scripts/fedora25/tuning.sh"
        ],
        "type": "shell",
        "pause_before": "120s",
        "start_retry_timeout": "15m",
        "expect_disconnect": "true",
        "only": ["magma-fedora25-virtualbox"]
    },
    {
      "scripts": [
        "scripts/freebsd11/magma.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "execute_command": "chmod +x {{ .Path }}",
      "only": ["magma-freebsd11-virtualbox"]
    },
    {
      "scripts": [
        "scripts/openbsd6/magma.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "execute_command": "chmod +x {{ .Path }}",
      "only": ["magma-openbsd6-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/apt.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["lineage-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/network.sh",
          "scripts/ubuntu1604/limits.sh",
          "scripts/ubuntu1604/lineage.sh",
          "scripts/ubuntu1604/vagrant.sh",
          "scripts/ubuntu1604/fixtty.sh",
          "scripts/ubuntu1604/virtualbox.sh",
          "scripts/ubuntu1604/vmware.sh",
          "scripts/ubuntu1604/qemu.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["lineage-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/apt.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/network.sh",
          "scripts/ubuntu1604/limits.sh",
          "scripts/ubuntu1604/postfix.sh",
          "scripts/ubuntu1604/database.sh",
          "scripts/ubuntu1604/memcached.sh",
          "scripts/ubuntu1604/magma.sh",
          "scripts/ubuntu1604/vagrant.sh",
          "scripts/ubuntu1604/fixtty.sh",
          "scripts/ubuntu1604/virtualbox.sh",
          "scripts/ubuntu1604/vmware.sh",
          "scripts/ubuntu1604/qemu.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/apt.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1604-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1604/network.sh",
          "scripts/ubuntu1604/limits.sh",
          "scripts/ubuntu1604/postfix.sh",
          "scripts/ubuntu1604/database.sh",
          "scripts/ubuntu1604/memcached.sh",
          "scripts/ubuntu1604/magma.sh",
          "scripts/ubuntu1604/vagrant.sh",
          "scripts/ubuntu1604/fixtty.sh",
          "scripts/ubuntu1604/virtualbox.sh",
          "scripts/ubuntu1604/vmware.sh",
          "scripts/ubuntu1604/qemu.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1604-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1610/apt.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1610-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1610/network.sh",
          "scripts/ubuntu1610/limits.sh",
          "scripts/ubuntu1610/postfix.sh",
          "scripts/ubuntu1610/database.sh",
          "scripts/ubuntu1610/memcached.sh",
          "scripts/ubuntu1610/magma.sh",
          "scripts/ubuntu1610/vagrant.sh",
          "scripts/ubuntu1610/fixtty.sh",
          "scripts/ubuntu1610/virtualbox.sh",
          "scripts/ubuntu1610/vmware.sh",
          "scripts/ubuntu1610/qemu.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1610-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1704/apt.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1704-virtualbox"]
    },
    {
      "scripts": [
          "scripts/ubuntu1704/network.sh",
          "scripts/ubuntu1704/limits.sh",
          "scripts/ubuntu1704/postfix.sh",
          "scripts/ubuntu1704/database.sh",
          "scripts/ubuntu1704/memcached.sh",
          "scripts/ubuntu1704/magma.sh",
          "scripts/ubuntu1704/vagrant.sh",
          "scripts/ubuntu1704/fixtty.sh",
          "scripts/ubuntu1704/virtualbox.sh",
          "scripts/ubuntu1704/vmware.sh",
          "scripts/ubuntu1704/qemu.sh"
      ],
      "type": "shell",
      "pause_before": "120s",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "only": ["magma-ubuntu1704-virtualbox"]
    },
    {
      "type": "file",
      "direction": "upload",
      "source": "res/blobs/system-blobs.tar.gz",
      "destination": "/home/vagrant/system-blobs.tar.gz",
      "only": ["lineage-virtualbox"]
    },
    {
      "scripts": [
        "scripts/common/zerodisk.sh",
        "scripts/common/lockout.sh"
      ],
      "type": "shell",
      "start_retry_timeout": "15m",
      "expect_disconnect": "true",
      "except": ["magma-freebsd11-virtualbox", "magma-openbsd6-virtualbox"]
    }
  ],
  "builders": [
    {
        "type": "virtualbox-iso",
        "name": "magma-virtualbox",
        "vm_name": "magma-virtualbox",
        "output_directory": "output/magma-virtualbox",
        "boot_wait": "20s",
        "boot_command": [
            "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/magma.centos6.vagrant.ks<enter><wait>"
        ],
        "disk_size": 32768,
        "vboxmanage": [
            [
                "modifyvm",
                "{{.Name}}",
                "--memory",
                "2048"
            ],
            [
                "modifyvm",
                "{{.Name}}",
                "--cpus",
                "2"
            ]
        ],
        "guest_os_type": "RedHat_64",
        "http_directory": "http",
        "headless": true,
        "iso_url": "https://mirrors.kernel.org/centos/6.9/isos/x86_64/CentOS-6.9-x86_64-minimal.iso",
        "iso_checksum": "422af57b493b8af49d485885a730c5a1d955f803fac85aa51311c393168b9080",
        "iso_checksum_type": "sha256",
        "ssh_username": "root",
        "ssh_password": "vagrant",
        "ssh_port": 22,
        "ssh_wait_timeout": "10000s",
        "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
        "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
        "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
        "guest_additions_path": "VBoxGuestAdditions.iso",
        "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
        "type": "virtualbox-iso",
        "name": "magma-centos6-virtualbox",
        "vm_name": "magma-centos6-virtualbox",
        "output_directory": "output/magma-centos6-virtualbox",
        "boot_wait": "20s",
        "boot_command": [
            "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/magma.centos6.vagrant.ks<enter><wait>"
        ],
        "disk_size": 32768,
        "vboxmanage": [
            [
                "modifyvm",
                "{{.Name}}",
                "--memory",
                "2048"
            ],
            [
                "modifyvm",
                "{{.Name}}",
                "--cpus",
                "2"
            ]
        ],
        "guest_os_type": "RedHat_64",
        "http_directory": "http",
        "headless": true,
        "iso_url": "https://mirrors.kernel.org/centos/6.9/isos/x86_64/CentOS-6.9-x86_64-minimal.iso",
        "iso_checksum": "422af57b493b8af49d485885a730c5a1d955f803fac85aa51311c393168b9080",
        "iso_checksum_type": "sha256",
        "ssh_username": "root",
        "ssh_password": "vagrant",
        "ssh_port": 22,
        "ssh_wait_timeout": "10000s",
        "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
        "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
        "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
        "guest_additions_path": "VBoxGuestAdditions.iso",
        "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
        "type": "virtualbox-iso",
        "name": "magma-centos7-virtualbox",
        "vm_name": "magma-centos7-virtualbox",
        "output_directory": "output/magma-centos7-virtualbox",
        "boot_wait": "20s",
        "boot_command": [
            "<tab>text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/magma.centos7.vagrant.ks<enter><wait>"
        ],
        "disk_size": 32768,
        "vboxmanage": [
            [
                "modifyvm",
                "{{.Name}}",
                "--memory",
                "2048"
            ],
            [
                "modifyvm",
                "{{.Name}}",
                "--cpus",
                "2"
            ]
        ],
        "guest_os_type": "RedHat_64",
        "http_directory": "http",
        "headless": true,
        "iso_url": "https://mirrors.kernel.org/centos/7.3.1611/isos/x86_64/CentOS-7-x86_64-Minimal-1611.iso",
        "iso_checksum": "27bd866242ee058b7a5754e83d8ee8403e216b93d130d800852a96f41c34d86a",
        "iso_checksum_type": "sha256",
        "ssh_username": "root",
        "ssh_password": "vagrant",
        "ssh_port": 22,
        "ssh_wait_timeout": "10000s",
        "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
        "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
        "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
        "guest_additions_path": "VBoxGuestAdditions.iso",
        "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-arch-virtualbox",
      "vm_name": "magma-arch-virtualbox",
      "output_directory": "output/magma-arch-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<enter><wait10><wait10><wait10>",
        "curl -O 'http://{{.HTTPIP}}:{{.HTTPPort}}/arch.install{,.chroot}.sh'<enter><wait>",
        "bash arch.install.sh < arch.install.chroot.sh && systemctl reboot<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "ArchLinux_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/archlinux/iso/2017.03.01/archlinux-2017.03.01-dual.iso",
      "iso_checksum": "4133a852f0b753133c600ebc4f0e1b393e6810cee7a8766a1c239a6dac9b7095",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-fedora25-virtualbox",
      "vm_name": "magma-fedora25-virtualbox",
      "output_directory": "output/magma-fedora25-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<tab> ",
        "inst.ks=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.fedora25.vagrant.ks ",
        "biosdevname=0 ",
        "net.ifnames=0 ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Fedora_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/fedora/releases/25/Server/x86_64/iso/Fedora-Server-netinst-x86_64-25-1.3.iso",
      "iso_checksum": "86bc3694f4938382753d1e9536f2140a6c9c1978207766340c679a89509073c7",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-debian8-virtualbox",
      "vm_name": "magma-debian8-virtualbox",
      "output_directory": "output/magma-debian8-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<esc><wait>",
        "auto ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.debian8.vagrant.cfg ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Debian_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/debian-cd/8.7.1/amd64/iso-cd/debian-8.7.1-amd64-netinst.iso",
      "iso_checksum": "749a15b7690769dd99e85d6104182a03d370b04b36106ec7cfaf6a551aa89fb4",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "lineage-virtualbox",
      "vm_name": "lineage-virtualbox",
      "output_directory": "output/lineage-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<enter><wait>",
        "<f6><esc>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs>",
        "/install/vmlinuz ",
        "initrd=/install/initrd.gz ",
        "auto-install/enable=true ",
        "debconf/priority=critical ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/lineage.ubuntu1604.vagrant.cfg<wait> ",
        "<enter>"
      ],
      "disk_size": 196608,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Ubuntu_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/ubuntu-releases/16.04.2/ubuntu-16.04.2-server-amd64.iso",
      "iso_checksum": "737ae7041212c628de5751d15c3016058b0e833fdc32e7420209b76ca3d0a535",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-ubuntu-virtualbox",
      "vm_name": "magma-ubuntu-virtualbox",
      "output_directory": "output/magma-ubuntu-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<enter><wait>",
        "<f6><esc>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs>",
        "/install/vmlinuz ",
        "initrd=/install/initrd.gz ",
        "auto-install/enable=true ",
        "debconf/priority=critical ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.ubuntu1604.vagrant.cfg<wait> ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Ubuntu_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/ubuntu-releases/16.04.2/ubuntu-16.04.2-server-amd64.iso",
      "iso_checksum": "737ae7041212c628de5751d15c3016058b0e833fdc32e7420209b76ca3d0a535",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-ubuntu1604-virtualbox",
      "vm_name": "magma-ubuntu1604-virtualbox",
      "output_directory": "output/magma-ubuntu1604-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<enter><wait>",
        "<f6><esc>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>",
        "<bs><bs><bs>",
        "/install/vmlinuz ",
        "initrd=/install/initrd.gz ",
        "auto-install/enable=true ",
        "debconf/priority=critical ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.ubuntu1604.vagrant.cfg<wait> ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Ubuntu_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/ubuntu-releases/16.04.2/ubuntu-16.04.2-server-amd64.iso",
      "iso_checksum": "737ae7041212c628de5751d15c3016058b0e833fdc32e7420209b76ca3d0a535",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-ubuntu1610-virtualbox",
      "vm_name": "magma-ubuntu1610-virtualbox",
      "output_directory": "output/magma-ubuntu1610-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<esc><wait>",
        "<esc><wait>",
        "<enter><wait>",
        "/install/vmlinuz ",
        "initrd=/install/initrd.gz ",
        "auto-install/enable=true ",
        "debconf/priority=critical ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.ubuntu1610.vagrant.cfg<wait> ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Ubuntu_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/ubuntu-releases/16.10/ubuntu-16.10-server-amd64.iso",
      "iso_checksum": "72b0d421da77f1e0c549b4efe6fc6c184e9909d6792f0d1e59b56d63e9705659",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-ubuntu1704-virtualbox",
      "vm_name": "magma-ubuntu1704-virtualbox",
      "output_directory": "output/magma-ubuntu1704-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "<esc><wait>",
        "<esc><wait>",
        "<enter><wait>",
        "/install/vmlinuz ",
        "initrd=/install/initrd.gz ",
        "auto-install/enable=true ",
        "debconf/priority=critical ",
        "preseed/url=http://{{.HTTPIP}}:{{.HTTPPort}}/magma.ubuntu1704.vagrant.cfg<wait> ",
        "<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Ubuntu_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/ubuntu-releases/17.04/ubuntu-17.04-server-amd64.iso",
      "iso_checksum": "ca5d9a8438e2434b9a3ac2be67b5c5fa2c1f8e3e40b954519462935195464034",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-gentoo-virtualbox",
      "vm_name": "magma-gentoo-virtualbox",
      "output_directory": "output/magma-gentoo-virtualbox",
      "boot_wait": "5s",
      "boot_command": [
        "gentoo-nofb<enter>",
        "<wait10><enter>",
        "<wait10><wait10><wait10><wait10><wait10><wait10>",
        "passwd root<enter><wait>",
        "vagrant<enter><wait>",
        "vagrant<enter><wait>",
        "sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config<enter><wait>",
        "echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config<enter><wait>",
        "/etc/init.d/sshd start<enter><wait>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "Gentoo_64",
      "headless": true,
      "iso_url": "https://mirrors.kernel.org/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/install-amd64-minimal-20170420.iso",
      "iso_checksum": "56d4c417d5e6ef4d701dbc50db5d815b4fa24b25889ec16609f4c4f0a331df5b",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "shutdown -hP now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-freebsd11-virtualbox",
      "vm_name": "magma-freebsd11-virtualbox",
      "output_directory": "output/magma-freebsd11-virtualbox",
      "boot_wait": "5s",
      "boot_command": [
        "<esc><wait>",
        "boot -s<wait>",
        "<enter><wait>",
        "<wait10><wait10>",
        "/bin/sh<enter><wait5>",
        "mdmfs -s 100m md1 /tmp<enter><wait5>",
        "mdmfs -s 100m md2 /mnt<enter><wait5>",
        "dhclient -l /tmp/dhclient.lease.em0 em0<enter><wait5>",
        "fetch -o /tmp/installerconfig http://{{ .HTTPIP }}:{{ .HTTPPort }}/magma.freebsd11.vagrant.cfg<enter><wait10>",
        "bsdinstall script /tmp/installerconfig && reboot<enter><wait>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "FreeBSD_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://ftp.fau.de/freebsd/releases/ISO-IMAGES/11.0/FreeBSD-11.0-RELEASE-amd64-disc1.iso",
      "iso_checksum": "08b12f2dc378f7a61b5469219824c74a2f9faef580acc85ffab45365df79872d",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "shutdown -p now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    },
    {
      "type": "virtualbox-iso",
      "name": "magma-openbsd6-virtualbox",
      "vm_name": "magma-openbsd6-virtualbox",
      "output_directory": "output/magma-openbsd6-virtualbox",
      "boot_wait": "20s",
      "boot_command": [
        "S<enter><wait>",
        "dhclient em0<enter><wait5>",
        "ftp -o /install.conf http://{{.HTTPIP}}:{{.HTTPPort}}/magma.openbsd6.install.cfg<enter><wait>",
        "ftp -o /install-chroot.sh http://{{.HTTPIP}}:{{.HTTPPort}}/magma.openbsd6.install.chroot.sh<enter><wait>",
        "/install -a -f /install.conf && chroot /mnt < /install-chroot.sh && reboot<enter>"
      ],
      "disk_size": 32768,
      "vboxmanage": [
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--memory",
                  "2048"
            ],
            [
                  "modifyvm",
                  "{{.Name}}",
                  "--cpus",
                  "2"
            ]
      ],
      "guest_os_type": "OpenBSD_64",
      "http_directory": "http",
      "headless": true,
      "iso_url": "https://ftp.fau.de/openbsd/6.1/amd64/cd61.iso",
      "iso_checksum": "37cee759db10ffd5c0d086771b62ed771187a24baa4946e601153e394ce31aa6",
      "iso_checksum_type": "sha256",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_port": 22,
      "ssh_wait_timeout": "10000s",
      "shutdown_command": "shutdown -h -p now",
      "guest_additions_url": "http://download.virtualbox.org/virtualbox/5.1.20/VBoxGuestAdditions_5.1.20.iso",
      "guest_additions_sha256": "8f1aa5ffda9f9cfb1dd5faa1fafd909763a1f6204cce2045e0912a2583ba75e9",
      "guest_additions_path": "VBoxGuestAdditions.iso",
      "virtualbox_version_file": "VBoxVersion.txt"
    }
  ],
  "post-processors": [
    [
      {
        "type": "vagrant",
        "compression_level": 9,
        "keep_input_artifact": false,
        "vagrantfile_template": "tpl/magma.rb",
        "output": "output/{{build_name}}-{{user `box_version`}}.box",
        "except": ["lineage-virtualbox"]
      },
      {
        "type": "vagrant",
        "compression_level": 9,
        "keep_input_artifact": false,
        "vagrantfile_template": "tpl/lineage.rb",
        "output": "output/{{build_name}}-{{user `box_version`}}.box",
        "only": ["lineage-virtualbox"]
      },
      {
          "type": "atlas",
          "only": ["magma-virtualbox"],
          "artifact": "lavabit/magma",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-centos6-virtualbox"],
          "artifact": "lavabit/magma-centos6",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-centos7-virtualbox"],
          "artifact": "lavabit/magma-centos7",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-arch-virtualbox"],
          "artifact": "lavabit/magma-arch",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-gentoo-virtualbox"],
          "artifact": "lavabit/magma-gentoo",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-debian8-virtualbox"],
          "artifact": "lavabit/magma-debian",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-fedora25-virtualbox"],
          "artifact": "lavabit/magma-fedora",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-freebsd11-virtualbox"],
          "artifact": "lavabit/magma-freebsd",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-openbsd6-virtualbox"],
          "artifact": "lavabit/magma-openbsd",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["lineage-virtualbox"],
          "artifact": "lavabit/lineage",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The Lineage mobile operating system build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-ubuntu-virtualbox"],
          "artifact": "lavabit/magma-ubuntu",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-ubuntu1604-virtualbox"],
          "artifact": "lavabit/magma-ubuntu1604",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-ubuntu1610-virtualbox"],
          "artifact": "lavabit/magma-ubuntu1610",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
          "type": "atlas",
          "only": ["magma-ubuntu1704-virtualbox"],
          "artifact": "lavabit/magma-ubuntu1704",
          "artifact_type": "vagrant.box",
          "metadata": {
              "provider": "virtualbox",
              "version": "{{user `box_version`}}",
              "created_at": "{{timestamp}}",
              "description": "The magma encrypted mail daemon build environment."
          }
      },
      {
        "type": "artifice",
        "keep_input_artifact": true,
        "files": ["output/{{build_name}}-{{user `box_version`}}.box"]
      },
      {
        "type": "checksum",
        "checksum_types": ["sha256"],
        "keep_input_artifact": true,
        "output": "output/{{build_name}}-{{user `box_version`}}.box.sha256"
      }
    ]
  ]
}
